rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAdmin() {
      // 两种方式都支持：固定管理员邮箱 或 Firestore 里 role=admin
      return request.auth != null &&
        (
          lower(request.auth.token.email) == 'admin@homeherhealth.org' ||
          get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin'
        );
    }

    // ===== users 集合 =====
    match /users/{uid} {
      // 自己可以读写自己的；管理员可以读所有人（导出名册要用）
      allow read:  if request.auth != null && (request.auth.uid == uid || isAdmin());
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // ===== events 集合 =====
    match /events/{id} {
      // 所有人可读活动
      allow read: if true;
      // 只有管理员能写活动
      allow write: if isAdmin();
    }

    // 其它路径默认拒绝（安全）
    match /{document=**} {
      allow read, write: if false;
    }
  }
}